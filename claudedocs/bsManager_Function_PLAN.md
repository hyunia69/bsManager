# bsManager 기능 설계 문서

> 거래처 정보와 상담 내역을 관리하는 비즈니스 관계 관리(BRM) 시스템

---

## 1. 데이터 모델

### 1.1 거래처 (clients)

| 필드 | 타입 | 설명 | 필수 |
|------|------|------|------|
| id | UUID | 고유 식별자 | O |
| company_name | VARCHAR(100) | 회사명 | O |
| contact_person | VARCHAR(50) | 담당자 | O |
| phone | VARCHAR(20) | 연락처 | O |
| email | VARCHAR(100) | 이메일 | - |
| created_at | TIMESTAMP | 등록일시 | O |
| updated_at | TIMESTAMP | 수정일시 | O |

### 1.2 상담내역 (consultations)

| 필드 | 타입 | 설명 | 필수 |
|------|------|------|------|
| id | UUID | 상담 고유 ID | O |
| client_id | UUID (FK) | 거래처 ID | O |
| category | ENUM | 분류 (문의/클레임/요청/수리) | O |
| content | TEXT | 상담내역 | O |
| status | ENUM | 진행상태 (미진행/진행/완료) | O |
| created_at | TIMESTAMP | 상담일시 | O |
| updated_at | TIMESTAMP | 수정일시 | O |

---

## 2. 페이지별 설계 및 구현 체크리스트

### 2.1 거래처 관리 페이지 (`/clients`)

거래처를 등록, 수정, 검색하는 페이지

#### 기능 요구사항

- [x] **업체 등록 폼**
  - [x] 회사명 입력 (필수) - UI 구현
  - [x] 담당자 입력 (필수) - UI 구현
  - [x] 연락처 입력 (필수) - UI 구현
  - [x] 이메일 입력 (선택) - UI 구현
  - [x] 폼 유효성 검사
  - [x] 저장 버튼 → Supabase 연동

- [x] **업체 수정 기능**
  - [x] 목록에서 업체 선택 - UI 구현 (수정 버튼 존재)
  - [x] 기존 정보 폼에 로드
  - [x] 수정 후 저장

- [x] **업체 검색**
  - [x] 회사명으로 검색 - UI 구현
  - [x] 담당자로 검색 - UI 구현
  - [x] 검색 결과 필터링

- [x] **업체 목록 표시**
  - [x] 테이블 형태로 표시
  - [x] 페이지네이션

#### 컴포넌트 구조

```
ClientsPage/
├── ClientsPage.jsx           # 페이지 컨테이너 ✅
├── ClientsPage.module.css    # ✅
├── components/
│   ├── ClientForm.jsx        # 등록/수정 폼 (Modal로 통합)
│   ├── ClientList.jsx        # 목록 테이블 (페이지에 통합)
│   └── ClientSearch.jsx      # 검색 컴포넌트 (페이지에 통합)
```

---

### 2.2 상담내역기록 페이지 (`/consultation/new`)

새 상담을 기록하는 페이지

#### 기능 요구사항

- [x] **기존 업체 선택**
  - [x] 자동완성 검색 UI (Input 존재)
  - [x] 자동완성 기능 구현
  - [x] 업체 선택 시 정보 자동 입력

- [x] **새 업체 자동 등록**
  - [x] 존재하지 않는 회사명 입력 시
  - [x] 저장 시 자동으로 거래처 테이블에 등록

- [x] **2단 레이아웃**
  - [x] 왼쪽: 기존 상담내역 표시 (선택된 업체의)
  - [x] 오른쪽: 새 상담 입력 폼

- [x] **상담 입력 폼**
  - [x] 분류 선택 (문의/클레임/요청/수리)
  - [x] 상담내역 입력 (textarea)
  - [x] 날짜/시간 자동 기입 (현재 시간)
  - [x] 저장 버튼 - UI 구현

- [x] **저장 처리**
  - [x] 진행상태 기본값: "미진행"
  - [x] Supabase 저장

#### 컴포넌트 구조

```
ConsultationNewPage/
├── ConsultationNewPage.jsx       # 페이지 컨테이너 ✅
├── ConsultationNewPage.module.css # ✅
├── components/
│   ├── ClientSelector.jsx        # 업체 선택 (페이지에 통합)
│   ├── ConsultationHistory.jsx   # 기존 상담내역 (페이지에 통합)
│   └── ConsultationForm.jsx      # 새 상담 폼 (페이지에 통합)
```

#### 레이아웃 구조

```
┌──────────────────────────────────────────────────────────────┐
│  [ 업체 검색/선택 (자동완성) ]                                 │
├─────────────────────────────┬────────────────────────────────┤
│                             │                                │
│    기존 상담내역             │      새 상담 입력               │
│                             │                                │
│    - 2024-01-15 문의        │    분류: [문의 ▼]              │
│      "제품 문의..."          │                                │
│                             │    상담내역:                    │
│    - 2024-01-10 요청        │    ┌──────────────────┐        │
│      "견적 요청..."          │    │                  │        │
│                             │    │                  │        │
│                             │    └──────────────────┘        │
│                             │                                │
│                             │    날짜: 2024-01-20 14:30 (자동)│
│                             │                                │
│                             │    [ 저장 ]                     │
│                             │                                │
└─────────────────────────────┴────────────────────────────────┘
```

---

### 2.3 상담내역리스트 페이지 (`/consultations`)

상담 목록을 조회하고 관리하는 페이지

#### 기능 요구사항

- [x] **목록 표시**
  - [x] 회사명
  - [x] 담당자
  - [x] 연락처
  - [x] 분류
  - [x] 상담내역 (요약)
  - [x] 등록일시
  - [x] 진행상태

- [x] **진행상태 변경**
  - [x] 미진행 → 진행 → 완료 상태 변경 - UI 구현
  - [x] 드롭다운으로 변경 기능
  - [x] 즉시 저장

- [x] **정렬**
  - [x] 최신순 기본 정렬 (created_at DESC)

- [x] **검색**
  - [x] 회사명 검색 - UI 구현
  - [x] 날짜 범위 검색 (DateRangePicker)
  - [x] 진행상태 필터 - UI 구현
  - [x] 검색 기능 연동

- [x] **상담 상세보기**
  - [x] 상담내역 클릭 시 Modal 팝업
  - [x] 전체 상담내역 표시
  - [x] 업체 정보 표시

- [x] **회사통합내역**
  - [x] "회사통합" 버튼 - UI 구현
  - [x] 라우팅 설정 (/clients/:id/history)
  - [x] 해당 회사의 모든 상담내역 동적 로드
  - [x] 날짜별 정리 (최신순)

#### 컴포넌트 구조

```
ConsultationsPage/
├── ConsultationsPage.jsx         # 페이지 컨테이너 ✅
├── ConsultationsPage.module.css  # ✅
├── components/
│   ├── ConsultationTable.jsx     # 목록 테이블 (페이지에 통합)
│   ├── ConsultationSearch.jsx    # 검색 영역 (페이지에 통합)
│   ├── StatusBadge.jsx           # 진행상태 표시/변경 (공통 컴포넌트 사용)
│   ├── ConsultationModal.jsx     # 상세보기 팝업 (미구현)
│   └── CompanyHistoryView.jsx    # 회사통합내역 (별도 페이지로 분리됨)
```

#### 레이아웃 구조

```
┌──────────────────────────────────────────────────────────────┐
│  [ 검색 ]  회사명: [        ]  진행상태: [전체 ▼]             │
├──────────────────────────────────────────────────────────────┤
│ 회사명  │ 담당자 │ 연락처 │ 분류 │ 상담내역 │ 등록일시 │ 상태 │
├─────────┼────────┼────────┼──────┼──────────┼──────────┼──────┤
│ A사     │ 김철수 │ 010... │ 문의 │ 제품...  │ 01-03... │[변경]│
│         │        │        │      │          │          │      │
│         │        │        │      │          │[회사통합]│      │
├─────────┼────────┼────────┼──────┼──────────┼──────────┼──────┤
│ B사     │ 박영희 │ 010... │ 수리 │ 장비...  │ 01-02... │ 진행 │
└──────────────────────────────────────────────────────────────┘
```

---

### 2.4 회사통합내역 페이지/뷰 (`/clients/:id/history`)

특정 회사의 모든 상담내역을 날짜별로 정리하여 표시

#### 기능 요구사항

- [x] **회사 정보 표시**
  - [x] 회사명, 담당자, 연락처, 이메일
  - [x] URL 파라미터 기반 동적 로드

- [x] **상담내역 타임라인**
  - [x] 날짜별 그룹핑
  - [x] 최신순 정렬
  - [x] 분류(카테고리) 표시
  - [x] 진행상태 표시
  - [x] Supabase 데이터 연동

#### 레이아웃 구조

```
┌──────────────────────────────────────────────────────────────┐
│  회사명: A사                                                  │
│  담당자: 김철수  |  연락처: 010-1234-5678  |  a@company.com   │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ● 2024-01-20                                               │
│    ├─ [문의] 제품 사양 관련 문의... (미진행)                  │
│    └─ [요청] 견적서 요청... (완료)                           │
│                                                              │
│  ● 2024-01-15                                               │
│    └─ [클레임] 배송 지연 관련... (진행)                      │
│                                                              │
│  ● 2024-01-10                                               │
│    └─ [수리] 장비 수리 요청... (완료)                        │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## 3. 공통 컴포넌트

기존 Linear 디자인 시스템 컴포넌트 활용 + 추가 컴포넌트

### 3.1 기존 컴포넌트 활용

| 컴포넌트 | 용도 | 구현 상태 |
|----------|------|-----------|
| Button | 저장, 검색, 상태 변경 버튼 | ✅ 완료 |
| Card | 컨텐츠 영역 래핑 | ✅ 완료 |
| Modal | 거래처 등록/수정 팝업 | ✅ 완료 |
| Input | 텍스트 입력 필드 | ✅ 완료 |
| Form | 등록/수정 폼 구성 | ✅ 완료 |

### 3.2 추가 필요 컴포넌트

- [x] **Select** - 드롭다운 선택 (분류, 진행상태)
- [x] **Table** - 데이터 테이블
- [x] **Badge/StatusBadge** - 상태 표시 (미진행/진행/완료)
- [x] **Autocomplete** - 업체 자동완성 검색 (CSS 드롭다운으로 구현)
- [x] **DatePicker/DateRangePicker** - 날짜 범위 선택
- [x] **Pagination** - 페이지네이션
- [x] **Textarea** - 상담내역 입력
- [x] **Timeline** - 회사통합내역 타임라인 (CSS로 구현)

---

## 4. 라우팅 구조

- [x] **라우팅 설정 완료** (React Router v7)

```javascript
// App.jsx 또는 router 설정
const routes = [
  { path: '/', element: <Landing /> },
  { path: '/clients', element: <ClientsPage /> },
  { path: '/clients/:id/history', element: <CompanyHistoryPage /> },
  { path: '/consultation/new', element: <ConsultationNewPage /> },
  { path: '/consultations', element: <ConsultationsPage /> },
];
```

---

## 5. 구현 우선순위

### Phase 1: 기반 구조
- [x] 라우팅 설정
- [x] 추가 컴포넌트 (Select, Table, Badge 등)
- [x] Supabase 서비스 레이어

### Phase 2: 거래처 관리
- [x] ClientsPage UI 구현
- [x] 거래처 CRUD 기능 연동

### Phase 3: 상담내역기록
- [x] ConsultationNewPage UI 구현
- [x] 업체 선택/자동등록
- [x] 상담 저장

### Phase 4: 상담내역리스트
- [x] ConsultationsPage UI 구현
- [x] 검색/필터링 기능
- [x] 진행상태 변경
- [ ] 상세보기 Modal

### Phase 5: 회사통합내역
- [x] CompanyHistoryPage UI 구현
- [x] 타임라인 동적 데이터 로드

---

## 6. 네비게이션 구조

- [x] **MainLayout 완료** (상단 네비게이션 바)

```
┌─────────────────────────────────────────┐
│  bsManager    [거래처관리] [상담기록] [상담목록]  │
└─────────────────────────────────────────┘
```

- **거래처관리** → `/clients`
- **상담기록** → `/consultation/new`
- **상담목록** → `/consultations`

---

## 7. 구현 상태 요약

| 영역 | 진행률 | 상태 |
|------|--------|------|
| UI/컴포넌트 | 100% | ✅ 완료 |
| 라우팅 | 100% | ✅ 완료 |
| 서비스 레이어 | 100% | ✅ 완료 |
| 기능 구현 | 100% | ✅ 완료 |
| Supabase 연동 | 100% | ✅ 완료 |

**총 구현 진도: 100%**

### 최근 구현 완료 항목 (2026-01-03)
- [x] 페이지네이션 (거래처 목록, 상담 목록)
- [x] 날짜 범위 검색 (DateRangePicker)
- [x] 상담 상세보기 Modal

---

*Last Updated: 2026-01-03*
